---
# yaml-language-server: $schema=https://taskfile.dev/schema.json
version: "3"

tasks:
  secret-audiobookshelf:
    internal: true
    cmds:
      - task: vault
        vars: { PATH: ops/media/audiobookshelf, SECRET: "api_key='{{.api_key}}'" }
    vars:
      api_key:
        sh: task secrets:get:audiobookshelf.sbbh.cloud:api-key

  secret-bazarr:
    internal: true
    cmds:
      - task: vault
        vars: { PATH: ops/media/bazarr, SECRET: "api_key='{{.api_key}}'" }
    vars:
      api_key:
        sh: task secrets:get:bazarr.sbbh.cloud:api-key

  secret-calibre:
    internal: true
    cmds:
      - task: vault
        vars: { PATH: ops/media/calibre, SECRET: "user='{{.user}}' password='{{.password}}'" }
    vars:
      user:
        sh: task secrets:get:calibre.sbbh.cloud:username
      password:
        sh: task secrets:get:calibre.sbbh.cloud:password

  secret-kometa:
    internal: true
    cmds:
      - task: vault
        vars: { PATH: ops/media/kometa, SECRET: "mdblist_key='{{.mdblist_key}}' omdb_key='{{.omdb_key}}' tmdb_key='{{.tmdb_key}}'" }
    vars:
      mdblist_key:
        sh: task secrets:get:mdblist.com:api-key
      omdb_key:
        sh: task secrets:get:omdbapi.com:api-key
      tmdb_key:
        sh: task secrets:get:themoviedb.org:api-key

  secret-plex:
    internal: true
    cmds:
      - task: vault
        vars: { PATH: ops/media/plex, SECRET: "token='{{.token}}'" }
    vars:
      token:
        sh: task secrets:get:plex.sbbh.cloud:token

  secret-prowlarr:
    internal: true
    cmds:
      - task: vault
        vars: { PATH: ops/media/prowlarr, SECRET: "api_key='{{.api_key}}'" }
    vars:
      api_key:
        sh: task secrets:get:prowlarr.sbbh.cloud:api-key

  secret-qbittorrent:
    internal: true
    cmds:
      - task: vault
        vars: { PATH: ops/media/qbittorrent, SECRET: "user='{{.user}}' password='{{.password}}' mam_id='{{.mam_id}}'" }
    vars:
      user:
        sh: task secrets:get:qbittorrent.sbbh.cloud:username
      password:
        sh: task secrets:get:qbittorrent.sbbh.cloud:password
      mam_id:
        sh: tr -d '\n' < {{.PRIVATE_DIR}}/misc/mam_id
    preconditions:
      - test -f {{.PRIVATE_DIR}}/misc/mam_id

  secret-radarr:
    internal: true
    cmds:
      - task: vault
        vars: { PATH: ops/media/radarr, SECRET: "api_key='{{.api_key}}'" }
    vars:
      api_key:
        sh: task secrets:get:radarr.sbbh.cloud:api-key

  secret-sabnzbd:
    internal: true
    cmds:
      - task: vault
        vars: { PATH: ops/media/sabnzbd, SECRET: "api_key='{{.api_key}}'" }
    vars:
      api_key:
        sh: task secrets:get:sabnzbd.sbbh.cloud:api-key

  secret-sonarr:
    internal: true
    cmds:
      - task: vault
        vars: { PATH: ops/media/sonarr, SECRET: "api_key='{{.api_key}}'" }
    vars:
      api_key:
        sh: task secrets:get:sonarr.sbbh.cloud:api-key

  secret-tautulli:
    internal: true
    cmds:
      - task: vault
        vars: { PATH: ops/media/tautulli, SECRET: "api_key='{{.api_key}}'" }
    vars:
      api_key:
        sh: task secrets:get:tautulli.sbbh.cloud:api-key
